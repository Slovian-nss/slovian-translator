<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perkladačь slověnьskogo ęzyka</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: system-ui, sans-serif; }
        .tail-container { max-width: 640px; margin: 0 auto; padding: 20px; }
    </style>
</head>
<body class="bg-zinc-950 text-zinc-100 min-h-screen">
    <div class="tail-container">
        <h1 class="text-3xl font-bold text-center mb-6">Perkladačь slověnьskogo ęzyka</h1>
        
        <input id="input" 
               class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-5 py-4 text-lg focus:outline-none focus:border-emerald-600"
               placeholder="Vupiši slovo abo rěčenьje:" 
               onkeydown="if(event.key==='Enter') translate()">
        
        <button onclick="translate()" 
                class="mt-4 w-full bg-emerald-600 hover:bg-emerald-700 py-4 rounded-xl font-medium text-lg">
            Perkladni
        </button>

        <div id="result" class="mt-8 hidden bg-zinc-900 border border-emerald-900 rounded-2xl p-6 text-xl leading-relaxed"></div>

        <details id="sources" class="mt-6 hidden">
            <summary class="cursor-pointer text-emerald-400 font-medium mb-2">Užito žerdlo jiz osnovy</summary>
            <div id="sources-list" class="text-sm text-zinc-400 space-y-1"></div>
        </details>
    </div>

    <script>
        let dictIndex = {};
        fetch('osnova.json').then(r => r.json()).then(data => {
            data.forEach(entry => {
                let pl = (entry.polish || '').toLowerCase().trim();
                if (pl) {
                    if (!dictIndex[pl]) dictIndex[pl] = [];
                    dictIndex[pl].push(entry);
                }
            });
        });

        function escapeRegExp(str) {
            return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function getRelevant(text) {
            let clean = text.toLowerCase().replace(/[^\w\s]/g, '');
            let words = clean.split(/\s+/).filter(w => w.length > 0);
            let entries = [];
            words.forEach(w => {
                if (dictIndex[w]) entries.push(...dictIndex[w]);
                else if (w.length > 3) {
                    for (let k in dictIndex) {
                        if (k.startsWith(w.slice(0,4)) && k.length > 3) {
                            entries.push(...dictIndex[k]);
                        }
                    }
                }
            });
            let seen = new Set();
            let unique = [];
            entries.forEach(e => {
                let id = e.slovian + '|' + (e['type and case'] || '');
                if (!seen.has(id)) {
                    seen.add(id);
                    unique.push(e);
                }
            });
            return unique.slice(0, 40);
        }

        function translate() {
            let input = document.getElementById('input').value.trim();
            if (!input) return;

            let matches = getRelevant(input);
            let result = input;

            matches.forEach(m => {
                let plLower = (m.polish || '').toLowerCase();
                let sl = (m.slovian || '').toLowerCase();
                let regex = new RegExp('\\b' + escapeRegExp(plLower) + '\\b', 'gi');
                result = result.replace(regex, match => {
                    if (match === match.toUpperCase()) return sl.toUpperCase();
                    if (match[0] === match[0].toUpperCase()) return sl[0].toUpperCase() + sl.slice(1);
                    return sl;
                });
            });

            if (matches.length === 0) result = "(ne najdeno slova)";

            let resDiv = document.getElementById('result');
            resDiv.innerHTML = `<strong class="text-emerald-400">Vynik perklada:</strong><br>${result}`;
            resDiv.classList.remove('hidden');

            let srcDiv = document.getElementById('sources');
            let list = document.getElementById('sources-list');
            list.innerHTML = '';
            if (matches.length > 0) {
                srcDiv.classList.remove('hidden');
                matches.forEach(m => {
                    let li = document.createElement('div');
                    li.innerHTML = `<strong>${m.polish}</strong> → <code class="text-emerald-300">${m.slovian}</code> <span class="text-xs">(${m['type and case'] || ''})</span>`;
                    list.appendChild(li);
                });
            } else {
                srcDiv.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
