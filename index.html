<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perkladačь slověnьskogo ęzyka (OFFLINE)</title>
    <style>
        body { background-color: #0e1117; color: #dcdcdc; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; max-width: 800px; margin: auto; }
        .container { background-color: #1a1a1a; padding: 20px; border-radius: 10px; border: 1px solid #333; }
        input { width: 100%; padding: 12px; background: #000; border: 1px solid #444; color: white; border-radius: 5px; margin-bottom: 10px; box-sizing: border-box; }
        button { background-color: #2e7d32; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px; width: 100%; font-weight: bold; }
        button:hover { background-color: #388e3c; }
        #output { margin-top: 20px; padding: 15px; background-color: #050505; border: 1px solid #2e7d32; border-radius: 5px; display: none; }
        #loader { display: none; color: #888; font-size: 0.9rem; margin-top: 10px; }
        .source-box { font-size: 0.8rem; color: #777; margin-top: 15px; border-top: 1px dashed #444; padding-top: 10px; }
        h3 { color: #2e7d32; }
    </style>
</head>
<body>
<div class="container">
    <h2>Perkladačь slověnьskogo ęzyka</h2>
    <p style="color: #888;">Vupiši slovo abo rěčenьje (Działa bez API):</p>
    <input type="text" id="userInput" placeholder="np. Matka i ojciec...">
    <button onclick="translateLocal()">Perloži</button>
    
    <div id="loader">Analiza gramatyczna i przeszukiwanie bazy...</div>
    <div id="output">
        <h3>Vynik perklada:</h3>
        <div id="responseText" style="font-size: 1.2rem;"></div>
        <div id="contextData" class="source-box">Logika: Algorytm lokalny (Offline)</div>
    </div>
</div>

<script>
    let dictionary = [];
    let grammarRules = [];

    // Ładowanie baz danych przy starcie
    async function loadDatabases() {
        try {
            const resOsnova = await fetch('osnova.json');
            dictionary = await resOsnova.json();
            const resVuzor = await fetch('vuzor.json');
            grammarRules = await resVuzor.json();
            console.log("Bazy załadowane pomyślnie.");
        } catch (e) {
            console.error("Błąd ładowania baz danych. Upewnij się, że pliki osnova.json i vuzor.json są w tym samym folderze.", e);
        }
    }

    function applyCase(original, translated) {
        if (original === original.toUpperCase()) return translated.toUpperCase();
        if (original[0] === original[0].toUpperCase()) return translated.charAt(0).toUpperCase() + translated.slice(1);
        return translated.toLowerCase();
    }

    function translateLocal() {
        const input = document.getElementById('userInput').value.trim();
        if (!input) return;

        document.getElementById('loader').style.display = "block";
        document.getElementById('output').style.display = "none";

        // Rozbicie na słowa i proste czyszczenie z interpunkcji
        const words = input.split(/\s+/);
        let results = [];

        // Logika "Przymiotnik przed rzeczownikiem" wymaga identyfikacji części mowy
        // Tutaj stosujemy uproszczone tłumaczenie słowo po słowie z zachowaniem wielkości liter
        for (let i = 0; i < words.length; i++) {
            let originalWord = words[i];
            let cleanWord = originalWord.toLowerCase().replace(/[.,!?;]/g, "");
            let punctuation = originalWord.match(/[.,!?;]/g) || "";

            // Szukanie w osnova.json
            let entry = dictionary.find(item => item.POL === cleanWord);
            
            if (entry) {
                let translated = applyCase(cleanWord, entry.SLOV);
                results.push(translated + punctuation);
            } else {
                results.push(applyCase(originalWord, "(ne najdeno slova)") + punctuation);
            }
        }

        // Prosta zamiana kolejności (jeśli przymiotnik był po rzeczowniku)
        // Wymagałoby to pełnego tagowania części mowy w JSON, poniżej szkielet:
        /* for (let i = 0; i < results.length - 1; i++) {
             // Jeśli results[i] to rzeczownik a results[i+1] to przymiotnik -> zamień miejscami
        }
        */

        setTimeout(() => {
            document.getElementById('responseText').innerText = results.join(" ");
            document.getElementById('loader').style.display = "none";
            document.getElementById('output').style.display = "block";
        }, 200); // Małe opóźnienie dla efektu wizualnego
    }

    loadDatabases();
</script>
</body>
</html>
