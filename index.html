<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perkladačь slověnьskogo ęzyka (Local Engine)</title>
    <style>
        body { background-color: #0e1117; color: #dcdcdc; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; max-width: 800px; margin: auto; }
        .container { background-color: #1a1a1a; padding: 20px; border-radius: 10px; border: 1px solid #333; }
        input { width: 100%; padding: 12px; background: #000; border: 1px solid #444; color: white; border-radius: 5px; margin-bottom: 10px; box-sizing: border-box; }
        button { background-color: #2e7d32; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px; width: 100%; font-weight: bold; }
        button:hover { background-color: #388e3c; }
        #output { margin-top: 20px; padding: 15px; background-color: #050505; border: 1px solid #2e7d32; border-radius: 5px; display: none; }
        #loader { display: none; color: #888; font-size: 0.9rem; margin-top: 10px; }
        .source-box { font-size: 0.8rem; color: #777; margin-top: 15px; border-top: 1px dashed #444; padding-top: 10px; }
    </style>
</head>
<body>
<div class="container">
    <h2>Perkladačь slověnьskogo ęzyka</h2>
    <p style="color: #888;">Tryb: Pełna niezależność (Offline / No API)</p>
    <input type="text" id="userInput" placeholder="Wpisz tekst (np. Wojsko Słowiańskie)">
    <button onclick="runLocalTranslator()">Perloži</button>
    
    <div id="loader">Przetwarzanie reguł gramatycznych...</div>
    <div id="output">
        <h3>Vynik perklada:</h3>
        <div id="responseText" style="font-size: 1.2rem;"></div>
        <div id="contextData" class="source-box">Logika: Rygorystyczny silnik JS (No API)</div>
    </div>
</div>

<script>
    let dictionary = [];
    let paradigms = [];

    // 1. ŁADOWANIE BAZY
    async function loadData() {
        try {
            const res1 = await fetch('osnova.json');
            dictionary = await res1.json();
            const res2 = await fetch('vuzor.json');
            paradigms = await res2.json();
        } catch (e) { console.error("Błąd plików .json", e); }
    }

    // 2. LOGIKA CASE-BY-CASE
    function matchCase(original, target) {
        if (original === original.toUpperCase()) return target.toUpperCase();
        if (original[0] === original[0].toUpperCase()) return target.charAt(0).toUpperCase() + target.slice(1);
        return target.toLowerCase();
    }

    // 3. SILNIK TŁUMACZĄCY
    function runLocalTranslator() {
        const text = document.getElementById('userInput').value.trim();
        if (!text) return;

        document.getElementById('loader').style.display = "block";
        
        let words = text.split(/\s+/);
        let processed = [];

        // KROK 1: Podstawowe mapowanie i zbieranie części mowy
        for (let i = 0; i < words.length; i++) {
            let clean = words[i].toLowerCase().replace(/[.,!?;]/g, "");
            let punct = words[i].match(/[.,!?;]/g) || "";
            
            let entry = dictionary.find(e => e.POL === clean);
            
            if (entry) {
                processed.push({
                    original: words[i],
                    translated: entry.SLOV,
                    pos: entry.POS, // Zakładam, że masz kolumnę POS w osnova.json
                    punct: punct
                });
            } else {
                processed.push({
                    original: words[i],
                    translated: "(ne najdeno slova)",
                    pos: "unknown",
                    punct: punct
                });
            }
        }

        // KROK 2: KRYTYCZNA ZASADA: Przymiotnik PRZED rzeczownikiem
        // Jeśli znajdziemy układ: Rzeczownik + Przymiotnik -> Zamieniamy kolejność
        for (let i = 0; i < processed.length - 1; i++) {
            if (processed[i].pos === "noun" && processed[i+1].pos === "adjective") {
                let temp = processed[i];
                processed[i] = processed[i+1];
                processed[i+1] = temp;
            }
        }

        // KROK 3: Rekonstrukcja tekstu i wielkości liter
        let finalText = processed.map(item => {
            let word = item.translated;
            if (word !== "(ne najdeno slova)") {
                word = matchCase(item.original, word);
            }
            return word + item.punct;
        }).join(" ");

        // WYŚWIETLANIE
        setTimeout(() => {
            document.getElementById('responseText').innerText = finalText;
            document.getElementById('loader').style.display = "none";
            document.getElementById('output').style.display = "block";
        }, 150);
    }

    loadData();
</script>
</body>
</html>
