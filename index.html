<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perkladačь slověnьskogo ęzyka</title>
    <style>
        body { background-color: #0e1117; color: #dcdcdc; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; max-width: 800px; margin: auto; }
        .container { background-color: #1a1a1a; padding: 20px; border-radius: 10px; border: 1px solid #333; }
        input { width: 100%; padding: 12px; background: #000; border: 1px solid #444; color: white; border-radius: 5px; margin-bottom: 10px; box-sizing: border-box; }
        button { background-color: #2e7d32; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px; width: 100%; font-weight: bold; }
        button:hover { background-color: #388e3c; }
        #output { margin-top: 20px; padding: 15px; background-color: #050505; border: 1px solid #2e7d32; border-radius: 5px; display: none; }
        #status { color: #888; font-size: 0.8rem; margin-bottom: 10px; }
    </style>
</head>
<body>
<div class="container">
    <h2>Perkladačь slověnьskogo ęzyka</h2>
    <div id="status">Wczytywanie...</div>
    <input type="text" id="userInput" placeholder="np. Wojsko Słowiańskie">
    <button onclick="translateLocal()">Perloži</button>
    
    <div id="output">
        <h3 style="color: #2e7d32;">Vynik perklada:</h3>
        <div id="responseText" style="font-size: 1.3rem;"></div>
    </div>
</div>

<script>
    let dictionary = [];

    async function init() {
        try {
            const res = await fetch('osnova.json');
            dictionary = await res.json();
            // Czyścimy bazę na starcie (usuwamy zbędne spacje)
            dictionary = dictionary.map(e => ({
                pol: String(e.POL || e.pol || "").trim().toLowerCase(),
                slov: String(e.SLOV || e.slov || "").trim(),
                pos: String(e.POS || e.pos || "").trim().toLowerCase()
            }));
            document.getElementById('status').innerText = "Baza gotowa (Offline)";
        } catch (e) {
            document.getElementById('status').innerText = "Błąd krytyczny plików!";
        }
    }

    function matchCase(original, target) {
        if (original === original.toUpperCase()) return target.toUpperCase();
        if (original[0] === original[0].toUpperCase()) return target[0].toUpperCase() + target.slice(1);
        return target.toLowerCase();
    }

    // Rygorystyczna palatalizacja wg promptu (k->c, g->dz przed ě)
    function applyPalatalization(word) {
        if (word.endsWith('kě')) return word.slice(0, -2) + 'cě';
        if (word.endsWith('gě')) return word.slice(0, -2) + 'dzě';
        return word;
    }

    function translateLocal() {
        const input = document.getElementById('userInput').value.trim();
        if (!input) return;

        let words = input.split(/\s+/);
        let results = [];

        for (let word of words) {
            let cleanPol = word.toLowerCase().replace(/[.,!?;]/g, "").trim();
            let punct = word.match(/[.,!?;]/g) || "";
            
            // Szukanie z rygorystycznym trimowaniem
            let entry = dictionary.find(e => e.pol === cleanPol);
            
            if (entry) {
                let slovak = applyPalatalization(entry.slov);
                results.push({
                    text: matchCase(cleanPol, slovak),
                    pos: entry.pos,
                    punct: punct,
                    original: word
                });
            } else {
                results.push({ text: matchCase(word, "(ne najdeno slova)"), pos: "", punct: punct });
            }
        }

        // KRYTYCZNY SZYK: Przymiotnik PRZED rzeczownik
        for (let i = 0; i < results.length - 1; i++) {
            if (results[i].pos === "noun" && results[i+1].pos === "adjective") {
                let temp = results[i];
                results[i] = results[i+1];
                results[i+1] = temp;
                // Zamiana interpunkcji
                let p = results[i].punct;
                results[i].punct = results[i+1].punct;
                results[i+1].punct = p;
            }
        }

        document.getElementById('responseText').innerText = results.map(r => r.text + r.punct).join(" ");
        document.getElementById('output').style.display = "block";
    }

    init();
</script>
</body>
</html>
